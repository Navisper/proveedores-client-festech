<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asistente de Viajes IA - Tolima Conecta</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 min-h-screen">

  <!-- Header -->
  <header class="bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg">
    <div class="container mx-auto px-4 py-6">
      <h1 class="text-3xl font-bold">Viva Tolima</h1>
      <p class="text-purple-100 mt-2">Asistente de Viajes con Inteligencia Artificial</p>
    </div>
  </header>

  <!-- Contenido principal -->
  <div class="container mx-auto px-4 py-8 max-w-3xl">
    <div class="bg-white rounded-xl shadow-lg p-6 lg:p-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Planifica tu viaje</h2>
      <p class="text-gray-600 mb-6">Complete el formulario y reciba recomendaciones personalizadas de nuestro asistente
        IA.</p>

      <!-- Formulario IA -->
      <form id="formIA" class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-1">Nombre</label>
          <input type="text" name="usuario" required placeholder="Ej: Juan Pérez"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-1">Preferencias</label>
          <input type="text" name="preferencias" required placeholder="Ej: playa, naturaleza"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-1">Fechas</label>
          <input type="text" name="fechas" required placeholder="Ej: 15-20 Octubre"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-1">Presupuesto</label>
          <input type="text" name="presupuesto" required placeholder="Ej: 2 millones COP"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-1">Número de personas</label>
          <input type="number" name="personas" min="1" value="1" required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <button id="btnEnviar" type="submit"
          class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 shadow-md">
          Consultar IA
        </button>
      </form>

      <!-- Respuesta IA / Loading -->
      <div id="respuestaIA"
        class="mt-6 hidden bg-purple-50 border-l-4 border-purple-500 p-4 rounded text-gray-800">
      </div>
    </div>
  </div>

  <!-- Script -->
  <script>
    const API_BASE = 'https://hackathon-festech-2025.onrender.com';
    const respuestaIA = document.getElementById('respuestaIA');
    const btnEnviar = document.getElementById('btnEnviar');

    document.getElementById('formIA').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);

      const datos = {
        usuario: formData.get("usuario"),
        preferencias: formData.get("preferencias"),
        fechas: formData.get("fechas"),
        presupuesto: formData.get("presupuesto"),
        personas: parseInt(formData.get("personas"))
      };

      try {
        // Mostrar cargando
        respuestaIA.classList.remove('hidden');
        respuestaIA.innerHTML = `
          <div class="flex items-center space-x-2 text-purple-700">
            <svg class="animate-spin h-5 w-5 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
            </svg>
            <span>Generando respuesta...</span>
          </div>`;
        btnEnviar.disabled = true;
        btnEnviar.classList.add("opacity-50", "cursor-not-allowed");

        const response = await fetch(`${API_BASE}/api/ai/chat`, {
          method: 'POST',
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(datos)
        });

        if (response.ok) {
          const resultado = await response.json();
          respuestaIA.innerHTML = `<p class="font-semibold">Respuesta de la IA:</p><p>${resultado.respuesta}</p>`;
        } else {
          respuestaIA.innerHTML = `<p class="text-red-600 font-semibold">Error al consultar la IA. Intente nuevamente.</p>`;
        }
      } catch (error) {
        respuestaIA.innerHTML = `<p class="text-red-600 font-semibold">Error de conexión con la IA.</p>`;
      } finally {
        btnEnviar.disabled = false;
        btnEnviar.classList.remove("opacity-50", "cursor-not-allowed");
      }
    });
  </script>
</body>

</html>
